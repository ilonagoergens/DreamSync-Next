import * as db from './database.js';

async function testDatabase() {
  console.log('\nüîç Starting database tests...\n');

  try {
    // Test 1: User Creation & Retrieval
    console.log('Test 1: User Creation & Retrieval');
    console.log('----------------------------------');
    
    const testUser = {
      id: 'test-' + Date.now(),
      email: `test${Date.now()}@example.com`,
      password: 'test123'
    };

    console.log('‚û°Ô∏è  Creating test user:', testUser.email);
    await db.createUser(testUser.id, testUser.email, testUser.password);
    console.log('‚úÖ User created successfully\n');
    
    console.log('‚û°Ô∏è  Retrieving test user...');
    const retrievedUser = await db.getUserByEmail(testUser.email);
    console.log('‚úÖ User retrieved successfully:', {
      id: retrievedUser.id,
      email: retrievedUser.email
    }, '\n');

    // Test 2: Vision Item Operations
    console.log('Test 2: Vision Item Operations');
    console.log('------------------------------');
    
    const visionItem = {
      id: 'vision-' + Date.now(),
      userId: testUser.id,
      imageUrl: 'https://example.com/test.jpg',
      section: 'career',
      text: 'Test vision item',
      x: 0,
      y: 0,
      width: 100,
      height: 100,
      zIndex: 1
    };

    console.log('‚û°Ô∏è  Creating vision item...');
    await db.createVisionItem(visionItem);
    console.log('‚úÖ Vision item created successfully\n');

    console.log('‚û°Ô∏è  Retrieving vision items...');
    const visionItems = await db.getVisionItems(testUser.id);
    console.log('‚úÖ Vision items retrieved:', visionItems.length, 'items found\n');

    // Test 3: Energy Entry Operations
    console.log('Test 3: Energy Entry Operations');
    console.log('------------------------------');
    
    const energyEntry = {
      id: 'energy-' + Date.now(),
      userId: testUser.id,
      date: new Date().toISOString().split('T')[0],
      level: 4,
      notes: 'Test energy entry'
    };

    console.log('‚û°Ô∏è  Creating energy entry...');
    await db.createEnergyEntry(energyEntry);
    console.log('‚úÖ Energy entry created successfully\n');

    console.log('‚û°Ô∏è  Retrieving energy entries...');
    const energyEntries = await db.getEnergyEntries(testUser.id);
    console.log('‚úÖ Energy entries retrieved:', energyEntries.length, 'entries found\n');

    console.log('üéâ All database tests passed successfully! üéâ\n');
    console.log('Database is properly configured and working.\n');

  } catch (error) {
    console.error('\n‚ùå Database test failed:', error.message);
    console.error('\nError details:', error);
    process.exit(1);
  }
}

testDatabase();